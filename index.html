<!DOCTYPE html>
<html lang="ru">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FPV Drone 2D</title>
<style>
    body { margin:0; background:#000; overflow:hidden; }
    canvas { background:#1a1a1a; display:block; margin:0 auto; }

    .joystick {
        position:fixed;
        width:130px; height:130px;
        border-radius:50%;
        background:#ffffff22;
    }
    .stick {
        width:60px; height:60px;
        border-radius:50%;
        background:#ffffff55;
        position:absolute;
        left:35px; top:35px;
    }

    #leftJoy { left:20px; bottom:20px; }
    #rightJoy { right:20px; bottom:20px; }

    #menu {
        position:fixed;
        top:0; left:0;
        width:100%; height:100%;
        background:#000c;
        color:white;
        display:flex;
        justify-content:center;
        align-items:center;
        flex-direction:column;
        font-size:30px;
    }

    .btn {
        padding:10px 20px;
        background:#222;
        border-radius:10px;
        margin-top:20px;
        font-size:25px;
    }
</style>
</head>
<body>

<div id="menu">
    FPV DRONE
    <div class="btn" onclick="startGame()">Начать игру</div>
</div>

<canvas id="game" width="900" height="500"></canvas>

<div id="leftJoy" class="joystick"><div class="stick"></div></div>
<div id="rightJoy" class="joystick"><div class="stick"></div></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let playing = false;

// ВРЕМЕННОЕ PNG ДРОНА (90×90)
const droneImg = new Image();
droneImg.src =
"https://i.imgur.com/tG2Z3hE.png"; // временный PNG (заменим на твой)

let drone = { x:200, y:250, speed:3 };

let bullets = [];
let enemies = [];
let buildings = [];
let soldiers = [];
let explosions = [];

// СОЗДАЕМ УРОВЕНЬ
function spawnLevel() {
    enemies = [];
    soldiers = [];
    buildings = [];
    explosions = [];

    // Танки
    for (let i=0; i<3; i++) {
        enemies.push({
            type:"tank",
            x:550 + Math.random()*300,
            y:100 + Math.random()*300,
            hp:8
        });
    }

    // Солдаты
    for (let i=0; i<5; i++) {
        soldiers.push({
            x:600 + Math.random()*250,
            y:80 + Math.random()*350,
            hp:2
        });
    }

    // Здания
    buildings.push(
        {x:700, y:150, w:100, h:120, hp:12},
        {x:780, y:320, w:100, h:100, hp:15}
    );
}

// ВЗРЫВ
function createExplosion(x,y){
    explosions.push({x,y,r:5,life:20});
}

// ИГРОВОЙ ЦИКЛ
function loop(){
    if (!playing) return;

    ctx.clearRect(0,0,900,500);

    // ДРОН PNG
    ctx.drawImage(droneImg, drone.x-45, drone.y-45, 90, 90);

    // ПУЛИ
    ctx.fillStyle="yellow";
    bullets.forEach(b=>{
        b.x += 12;
        ctx.fillRect(b.x, b.y, 10,3);
    });

    // ТАНКИ / ТЕХНИКА
    enemies.forEach(e=>{
        ctx.fillStyle="green";
        ctx.fillRect(e.x-20, e.y-15, 40, 30);

        ctx.fillStyle="red";
        ctx.fillRect(e.x-20, e.y-25, 40*(e.hp/8), 4);
    });

    // СОЛДАТЫ
    ctx.fillStyle="white";
    soldiers.forEach(s=>{
        ctx.fillRect(s.x-5, s.y-10, 10, 20);
    });

    // ЗДАНИЯ
    buildings.forEach(b=>{
        ctx.fillStyle="#333";
        ctx.fillRect(b.x,b.y,b.w,b.h);

        ctx.fillStyle="red";
        ctx.fillRect(b.x, b.y-7, b.w*(b.hp/15), 4);
    });

    // ВЗРЫВЫ
    explosions.forEach(ex=>{
        ctx.beginPath();
        ctx.arc(ex.x, ex.y, ex.r, 0, Math.PI*2);
        ctx.fillStyle=`rgba(255,150,0,${ex.life/20})`;
        ctx.fill();
        ex.r += 2;
        ex.life--;
    });
    explosions = explosions.filter(e=>e.life>0);

    // СТОЛКНОВЕНИЯ
    bullets.forEach(b=>{
        enemies.forEach(e=>{
            if (b.x>e.x-20 && b.x<e.x+20 &&
                b.y>e.y-15 && b.y<e.y+15) {
                e.hp--;
                b.x = 2000;
                createExplosion(e.x,e.y);
            }
        });

        soldiers.forEach(s=>{
            if (b.x>s.x-5 && b.x<s.x+5 &&
                b.y>s.y-10 && b.y<s.y+10) {
                s.hp--;
                b.x=2000;
                createExplosion(s.x,s.y);
            }
        });

        buildings.forEach(o=>{
            if (b.x>o.x && b.x<o.x+o.w &&
                b.y>o.y && b.y<o.y+o.h) {
                o.hp--;
                b.x=2000;
                createExplosion(b.x,b.y);
            }
        });
    });

    // УБИРАЕМ МЁРТВЫХ
    enemies = enemies.filter(e=>e.hp>0);
    soldiers = soldiers.filter(s=>s.hp>0);
    buildings = buildings.filter(o=>o.hp>0);

    // ПОБЕДА
    if (enemies.length===0 && soldiers.length===0 && buildings.length===0) {
        playing = false;
        document.getElementById("menu").style.display="flex";
    }

    requestAnimationFrame(loop);
}

// СТРЕЛЬБА
setInterval(()=>{
    if (!playing) return;
    bullets.push({ x:drone.x+10, y:drone.y });
}, 200);

// ДЖОЙСТИКИ
function joystick(id, cb) {
    const joy=document.getElementById(id);
    const stick=joy.children[0];

    joy.addEventListener("touchmove", e=>{
        const t=e.touches[0];
        const r=joy.getBoundingClientRect();

        let x=t.clientX - r.left - 60;
        let y=t.clientY - r.top  - 60;

        x=Math.max(-40, Math.min(40,x));
        y=Math.max(-40, Math.min(40,y));

        stick.style.left = (35 + x) + "px";
        stick.style.top  = (35 + y) + "px";

        cb(x/40, y/40);
    });

    joy.addEventListener("touchend", ()=>{
        stick.style.left="35px";
        stick.style.top="35px";
        cb(0,0);
    });
}

joystick("leftJoy",(lx,ly)=>{
    drone.x += lx * drone.speed;
    drone.y += ly * drone.speed;
});

joystick("rightJoy",(rx,ry)=>{ /* пока пусто */ });

function startGame(){
    document.getElementById("menu").style.display="none";
    drone.x=200; drone.y=250;
    spawnLevel();
    playing = true;
    loop();
}
</script>
</body>
</html>
